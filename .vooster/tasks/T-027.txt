# 리드 챗봇(Typebot) 퍼널 JSON 설계 반영 및 구조 개선

**Task ID:** T-027
**Status:** BACKLOG
**Importance:** MUST
**Complexity:** 7/10
**Urgency:** 9/10
**Dependencies:** T-026, T-005

## Description

### 요구사항
- 캡틴 제공 JSON 설계 로직 100% 반영, 눈콩이 마스코트 대사/톤 적용
- 퍼널 흐름 블록화/모듈화로 손쉬운 수정, 예약/상담 데이터 표준 필드 보장
- 문서화: 편집 가이드/버전관리/롤백 절차
### 구현 세부(라이브러리/디자인/아키텍처)
- Typebot API를 통해 JSON→블록 변환 스크립트 작성(노드 스크립트)
- 퍼널 스키마: steps, conditions, slots, validations, webhooks, analytics ids
- 저장: Supabase 'funnels' 테이블에 JSON 버전 저장, 배포시 최신 버전 publish 플래그
- 연동: 입력 Webhook→/api/leads 저장(기존) + /api/chat 연동 질문 핸오버
- 분석: GA4 이벤트 매핑(step_view, cta_click, submit_success)
### 의사코드
```ts
// scripts/deploy-typebot.ts
import { TypebotClient } from 'typebot-sdk';
const json = loadJson('funnel.json');
const blocks = transform(json);
await client.replaceFlow(process.env.TYPEBOT_ID!, blocks);
await saveVersion(json);
```
### 테스트 전략
- 계약 테스트: JSON 스키마 검증(Zod), 필수 필드/분기 누락 탐지
- 샌드박스: Staging 봇에 배포 후 퍼널 경로 전수 점검
- 회귀: 주요 경로 스냅샷(조건 분기별), 실패 시 롤백 스크립트 검증

---

**Created:** 2025-08-12T06:51:57.717Z
**Updated:** 2025-08-12T06:51:57.717Z
